<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Brands - ToyTap</title>
    <meta name="description" content="Browse toys by brand. LEGO, Fisher-Price, Melissa & Doug, and more." />
    <link rel="icon" type="image/png" href="https://i.imgur.com/HXSawxU.png" />
    <link rel="stylesheet" href="css/styles.css" />
    <style>
        .brands-hero {
            background: linear-gradient(135deg, #0a0e27 0%, var(--navy-dark) 50%, #1a1a2e 100%);
            padding: 50px 20px;
            text-align: center;
        }

        .brands-title {
            font-size: clamp(28px, 6vw, 48px);
            font-weight: 900;
            color: #fff;
            margin-bottom: 12px;
        }

        .brands-subtitle {
            font-size: 16px;
            color: rgba(255,255,255,0.7);
        }

        /* Brand Grid */
        .brands-section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .brands-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 40px;
        }

        .brand-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 24px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 1px solid rgba(109,195,213,0.15);
        }

        .brand-card:hover {
            transform: translateY(-4px);
            border-color: var(--cyan);
            box-shadow: 0 12px 30px rgba(0,0,0,0.3);
        }

        .brand-card.active {
            border-color: var(--cyan);
            background: rgba(109,195,213,0.1);
        }

        .brand-name {
            font-size: 16px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 8px;
        }

        .brand-count {
            font-size: 13px;
            color: var(--cyan);
            font-weight: 600;
        }

        /* Brand Detail View */
        .brand-detail {
            display: none;
        }

        .brand-detail.active {
            display: block;
        }

        .brand-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid rgba(109,195,213,0.15);
        }

        .brand-header-left {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .back-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: rgba(109,195,213,0.1);
            border: 1px solid rgba(109,195,213,0.3);
            border-radius: 10px;
            color: var(--cyan);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .back-btn:hover {
            background: var(--cyan);
            color: var(--navy);
        }

        .brand-detail-title {
            font-size: 28px;
            font-weight: 800;
            color: #fff;
        }

        .brand-stats {
            display: flex;
            gap: 24px;
        }

        .brand-stat {
            text-align: center;
        }

        .brand-stat-value {
            font-size: 24px;
            font-weight: 800;
            color: var(--cyan);
            font-family: 'JetBrains Mono', monospace;
        }

        .brand-stat-label {
            font-size: 12px;
            color: #94a3b8;
        }

        /* Toy Grid */
        .toy-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 20px;
        }

        .results-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 12px;
        }

        .results-count {
            font-size: 14px;
            color: #94a3b8;
        }

        .sort-select {
            padding: 10px 16px;
            background: var(--bg-card);
            border: 1px solid rgba(109,195,213,0.3);
            border-radius: 10px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: #94a3b8;
        }

        @media (max-width: 640px) {
            .brand-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .brand-stats {
                width: 100%;
                justify-content: space-around;
            }
        }
    </style>
</head>
<body>

<header class="site-header">
    <nav class="nav-container">
        <a href="index.html"><img src="https://i.imgur.com/HXSawxU.png" alt="ToyTap" class="nav-logo" /></a>
        <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
        </button>
        <div class="nav-links">
            <a href="index.html" class="nav-link">Home</a>
            <a href="rankings.html" class="nav-link">Rankings</a>
            <a href="brands.html" class="nav-link active">Brands</a>
            <a href="watchlist.html" class="nav-link">Watchlist</a>
            <a href="login.html" class="nav-link nav-login">Sign In</a>
        </div>
    </nav>
</header>

<main class="page-wrapper">
    <section class="brands-hero">
        <h1 class="brands-title">Shop by Brand</h1>
        <p class="brands-subtitle">Browse toys from your favorite brands</p>
    </section>

    <div class="brands-section">
        <!-- Brand Selection Grid -->
        <div id="brands-view">
            <div id="brands-grid" class="brands-grid">
                <div class="loading">
                    <div class="spinner"></div>
                    <p>Loading brands...</p>
                </div>
            </div>
        </div>

        <!-- Brand Detail View -->
        <div id="brand-detail" class="brand-detail">
            <div class="brand-header">
                <div class="brand-header-left">
                    <button class="back-btn" onclick="showAllBrands()">
                        &#8592; All Brands
                    </button>
                    <h2 class="brand-detail-title" id="brand-title">Brand Name</h2>
                </div>
                <div class="brand-stats">
                    <div class="brand-stat">
                        <div class="brand-stat-value" id="brand-toy-count">0</div>
                        <div class="brand-stat-label">Toys</div>
                    </div>
                    <div class="brand-stat">
                        <div class="brand-stat-value" id="brand-deal-count">0</div>
                        <div class="brand-stat-label">On Sale</div>
                    </div>
                </div>
            </div>

            <div class="results-info">
                <span class="results-count">Showing <span id="showing-count">0</span> toys</span>
                <select class="sort-select" id="sort-select" onchange="handleSortChange()">
                    <option value="score">Best Value</option>
                    <option value="price-low">Price: Low to High</option>
                    <option value="price-high">Price: High to Low</option>
                    <option value="rating">Highest Rated</option>
                </select>
            </div>

            <div id="toy-grid" class="toy-grid"></div>

            <div style="text-align: center; padding: 40px 0;">
                <button id="show-more-btn" class="btn btn-primary" onclick="showMore()" style="display: none;">
                    Show More
                </button>
            </div>
        </div>
    </div>
</main>

<footer class="site-footer">
    <div class="footer-container">
        <img src="https://i.imgur.com/HXSawxU.png" alt="ToyTap" class="footer-logo" />
        <div class="footer-links">
            <a href="https://gettoytap.com" class="footer-link">For Businesses</a>
            <a href="https://gettoytap.com/privacy" class="footer-link">Privacy</a>
        </div>
        <p class="footer-copy">2025 ToyTap. All rights reserved.</p>
    </div>
</footer>

<script src="js/api.js"></script>
<script>
// Tracked brands with display info
const TRACKED_BRANDS = [
    { name: 'LEGO', icon: 'ðŸ§±' },
    { name: 'Fisher-Price', icon: 'ðŸ‘¶' },
    { name: 'Melissa & Doug', icon: 'ðŸŽ¨' },
    { name: 'VTech', icon: 'ðŸ”Š' },
    { name: 'Play-Doh', icon: 'ðŸŽ­' },
    { name: 'Hot Wheels', icon: 'ðŸŽï¸' },
    { name: 'Barbie', icon: 'ðŸ‘±â€â™€ï¸' },
    { name: 'MAGNA-TILES', icon: 'ðŸ”·' },
    { name: 'PicassoTiles', icon: 'ðŸ”¶' },
    { name: 'Green Toys', icon: 'â™»ï¸' },
    { name: 'Hape', icon: 'ðŸªµ' },
    { name: 'Little Tikes', icon: 'ðŸ ' },
    { name: 'Step2', icon: 'ðŸŽ¢' },
    { name: 'KidKraft', icon: 'ðŸ¡' },
    { name: 'LeapFrog', icon: 'ðŸ¸' },
    { name: 'Learning Resources', icon: 'ðŸ“š' },
    { name: 'Skillmatics', icon: 'ðŸ§©' },
    { name: 'Snap Circuits', icon: 'âš¡' },
    { name: 'BRIO', icon: 'ðŸš‚' },
    { name: 'Infantino', icon: 'ðŸ¼' },
    { name: 'Playmags', icon: 'ðŸ§²' },
    { name: 'Spirograph', icon: 'ðŸŒ€' },
    { name: 'CATAN', icon: 'ðŸï¸' }
];

let currentBrand = null;
let brandToys = [];
let visibleCount = 24;
let currentSort = 'score';

document.addEventListener('DOMContentLoaded', () => {
    // Check URL for brand param
    const urlBrand = getUrlParam('brand');
    if (urlBrand) {
        selectBrand(urlBrand);
    } else {
        renderBrandsGrid();
    }
});

function renderBrandsGrid() {
    const grid = document.getElementById('brands-grid');

    grid.innerHTML = TRACKED_BRANDS.map(brand => `
        <div class="brand-card" onclick="selectBrand('${brand.name}')">
            <div style="font-size: 32px; margin-bottom: 12px;">${brand.icon || 'ðŸ§¸'}</div>
            <div class="brand-name">${brand.name}</div>
            <div class="brand-count">View toys â†’</div>
        </div>
    `).join('');
}

async function selectBrand(brandName) {
    currentBrand = brandName;
    visibleCount = 24;
    currentSort = 'score';

    // Update URL
    history.pushState({}, '', `brands.html?brand=${encodeURIComponent(brandName)}`);

    // Show detail view
    document.getElementById('brands-view').style.display = 'none';
    document.getElementById('brand-detail').classList.add('active');
    document.getElementById('brand-title').textContent = brandName;

    // Show loading
    document.getElementById('toy-grid').innerHTML = `
        <div class="loading" style="grid-column: 1/-1;">
            <div class="spinner"></div>
            <p>Loading ${brandName} toys...</p>
        </div>
    `;

    try {
        // Fetch toys for this brand
        const res = await fetch(`${API_BASE}/toys/brand/${encodeURIComponent(brandName)}?limit=100&sort=toy_tap_rank`);
        const data = await res.json();
        brandToys = data.toys || [];

        // Update stats
        document.getElementById('brand-toy-count').textContent = brandToys.length;
        const dealsCount = brandToys.filter(t => t.discount_percent && parseFloat(t.discount_percent) > 10).length;
        document.getElementById('brand-deal-count').textContent = dealsCount;

        sortAndRender();
    } catch (err) {
        console.error('Error loading brand:', err);
        document.getElementById('toy-grid').innerHTML = `
            <div class="loading" style="grid-column: 1/-1;">
                <p style="color: var(--red);">Failed to load toys</p>
                <button class="btn btn-primary" onclick="selectBrand('${brandName}')">Retry</button>
            </div>
        `;
    }
}

function showAllBrands() {
    currentBrand = null;
    history.pushState({}, '', 'brands.html');
    document.getElementById('brands-view').style.display = 'block';
    document.getElementById('brand-detail').classList.remove('active');
}

function sortAndRender() {
    // Sort toys
    let sorted = [...brandToys];
    switch (currentSort) {
        case 'price-low':
            sorted.sort((a, b) => (parseFloat(a.price) || 0) - (parseFloat(b.price) || 0));
            break;
        case 'price-high':
            sorted.sort((a, b) => (parseFloat(b.price) || 0) - (parseFloat(a.price) || 0));
            break;
        case 'rating':
            sorted.sort((a, b) => (parseFloat(b.rating) || 0) - (parseFloat(a.rating) || 0));
            break;
        default: // score
            sorted.sort((a, b) => (parseFloat(b.toy_tap_score) || 0) - (parseFloat(a.toy_tap_score) || 0));
    }

    const toShow = sorted.slice(0, visibleCount);
    document.getElementById('showing-count').textContent = toShow.length;

    if (toShow.length === 0) {
        document.getElementById('toy-grid').innerHTML = `
            <div class="loading" style="grid-column: 1/-1;">
                <p>No toys found for this brand</p>
            </div>
        `;
        document.getElementById('show-more-btn').style.display = 'none';
        return;
    }

    document.getElementById('toy-grid').innerHTML = toShow.map(toy =>
        renderToyCard(toy, { showGrade: true, linkToDetail: true })
    ).join('');

    document.getElementById('show-more-btn').style.display =
        visibleCount < sorted.length ? 'inline-flex' : 'none';
}

function handleSortChange() {
    currentSort = document.getElementById('sort-select').value;
    sortAndRender();
}

function showMore() {
    visibleCount += 24;
    sortAndRender();
}

function getUrlParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}
</script>
</body>
</html>
