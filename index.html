<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>ToyTap - Track Toy Prices, Find the Best Deals</title>

    <meta name="description" content="Track 14,000+ toys across Amazon, Walmart, and Target. Compare prices, see TT Grade scores, and never overpay for toys again." />
    <meta name="keywords" content="toy price tracker, toy deals, toy price comparison, Amazon toy deals, best toy prices" />

    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://dashboard.gettoytap.com/" />
    <meta property="og:title" content="ToyTap - Track Toy Prices, Find the Best Deals" />
    <meta property="og:description" content="Track 14,000+ toys across Amazon, Walmart, and Target. Never overpay for toys again." />

    <link rel="icon" type="image/png" href="https://i.imgur.com/HXSawxU.png" />
    <link rel="canonical" href="https://dashboard.gettoytap.com/" />

    <link rel="stylesheet" href="css/styles.css" />
    <style>
        /* Deals Page Specific Styles */
        .deals-hero {
            background: linear-gradient(135deg, #0a0e27 0%, var(--navy-dark) 50%, #1a1a2e 100%);
            padding: 50px 20px 40px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .deals-hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(ellipse at 30% 20%, rgba(109, 195, 213, 0.15) 0%, transparent 50%),
                        radial-gradient(ellipse at 70% 80%, rgba(253, 185, 19, 0.1) 0%, transparent 50%);
            pointer-events: none;
        }

        .deals-title {
            font-size: clamp(28px, 6vw, 48px);
            font-weight: 900;
            color: #fff;
            margin-bottom: 12px;
            position: relative;
            z-index: 1;
        }

        .deals-subtitle {
            font-size: 16px;
            color: rgba(255,255,255,0.7);
            margin-bottom: 28px;
            position: relative;
            z-index: 1;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 40px;
            flex-wrap: wrap;
            padding: 16px 20px;
            background: rgba(0,0,0,0.3);
            border-radius: 16px;
            max-width: 600px;
            margin: 0 auto 0;
            position: relative;
            z-index: 1;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 800;
            color: var(--cyan);
            font-family: 'JetBrains Mono', monospace;
        }

        .stat-value.green { color: var(--green); }
        .stat-value.yellow { color: var(--yellow); }

        .stat-label {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* 6-Tab Filter */
        .filter-tabs-container {
            padding: 24px 20px;
            text-align: center;
            position: sticky;
            top: 70px;
            z-index: 100;
            background: var(--bg-dark);
            border-bottom: 1px solid rgba(109,195,213,0.1);
        }

        .filter-tabs-6 {
            display: inline-flex;
            gap: 8px;
            padding: 8px;
            background: var(--bg-card);
            border-radius: 16px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .filter-tab-6 {
            padding: 12px 20px;
            background: transparent;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            color: #94a3b8;
            transition: all 0.2s;
            font-family: 'Inter', sans-serif;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .filter-tab-6:hover {
            background: rgba(109,195,213,0.1);
            color: #fff;
        }

        .filter-tab-6.active {
            background: linear-gradient(135deg, var(--cyan), var(--navy));
            color: #fff;
            box-shadow: 0 4px 12px rgba(109,195,213,0.3);
        }

        .filter-tab-6 .tab-icon {
            font-size: 16px;
        }

        /* Toy Card Enhancements */
        .toy-card-freshness {
            position: absolute;
            top: 12px;
            right: 12px;
            z-index: 3;
        }

        .freshness-pill {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            padding: 6px 10px;
            border-radius: 8px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.03em;
        }

        .freshness-pill.fresh {
            background: rgba(34, 197, 94, 0.15);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .freshness-pill.oneday {
            background: rgba(253, 185, 19, 0.15);
            color: #fbbf24;
            border: 1px solid rgba(253, 185, 19, 0.3);
        }

        .freshness-pill.aging {
            background: rgba(249, 115, 22, 0.15);
            color: #f97316;
            border: 1px solid rgba(249, 115, 22, 0.3);
        }

        .freshness-pill.old {
            background: rgba(107, 114, 128, 0.15);
            color: #9ca3af;
            border: 1px solid rgba(107, 114, 128, 0.3);
        }

        /* Deal Badge on Card */
        .toy-card-deal-badge {
            position: absolute;
            top: 12px;
            left: 12px;
            background: var(--green);
            color: #fff;
            padding: 6px 12px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 700;
            font-family: 'JetBrains Mono', monospace;
            z-index: 3;
        }

        /* Walmart badge */
        .walmart-badge {
            display: inline-flex;
            align-items: center;
            gap: 4px;
            background: var(--walmart-blue);
            color: #fff;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            margin-top: 8px;
        }

        /* Search Bar */
        .search-container {
            max-width: 500px;
            margin: 0 auto 24px;
            position: relative;
            z-index: 10;
        }

        .search-input {
            width: 100%;
            padding: 16px 20px 16px 50px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(109,195,213,0.3);
            border-radius: 14px;
            color: #fff;
            font-size: 15px;
            outline: none;
            transition: all 0.2s;
        }

        .search-input:focus {
            border-color: var(--cyan);
            background: rgba(255,255,255,0.15);
        }

        .search-input::placeholder {
            color: rgba(255,255,255,0.5);
        }

        .search-icon {
            position: absolute;
            left: 18px;
            top: 50%;
            transform: translateY(-50%);
            color: rgba(255,255,255,0.5);
        }

        .search-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--bg-card);
            border: 1px solid rgba(109,195,213,0.2);
            border-radius: 12px;
            margin-top: 8px;
            max-height: 400px;
            overflow-y: auto;
            display: none;
            box-shadow: 0 20px 40px rgba(0,0,0,0.4);
        }

        .search-result {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            cursor: pointer;
            transition: background 0.2s;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .search-result:hover {
            background: rgba(109,195,213,0.1);
        }

        .search-result:last-child {
            border-bottom: none;
        }

        .search-result img {
            width: 48px;
            height: 48px;
            object-fit: contain;
            background: #fff;
            border-radius: 8px;
        }

        .search-result-info {
            flex: 1;
            min-width: 0;
        }

        .search-result-name {
            font-size: 14px;
            font-weight: 600;
            color: #fff;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .search-result-brand {
            font-size: 12px;
            color: var(--cyan);
        }

        .search-result-price {
            font-size: 16px;
            font-weight: 700;
            color: #fff;
            font-family: 'JetBrains Mono', monospace;
        }

        /* Results Count */
        .results-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto 20px;
            padding: 0 20px;
        }

        .results-count {
            font-size: 14px;
            color: #94a3b8;
        }

        .results-count strong {
            color: var(--cyan);
        }

        /* Sort dropdown */
        .sort-select {
            background: var(--bg-card);
            border: 1px solid rgba(109,195,213,0.2);
            border-radius: 8px;
            padding: 10px 16px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .filter-tabs-6 {
                gap: 4px;
                padding: 6px;
            }

            .filter-tab-6 {
                padding: 10px 14px;
                font-size: 12px;
            }

            .filter-tab-6 .tab-icon {
                font-size: 14px;
            }

            .stats-bar {
                gap: 20px;
            }

            .stat-value {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>

<!-- Header -->
<header class="site-header">
    <nav class="nav-container">
        <a href="index.html">
            <img src="https://i.imgur.com/HXSawxU.png" alt="ToyTap" class="nav-logo" />
        </a>
        <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 12h18M3 6h18M3 18h18"/>
            </svg>
        </button>
        <div class="nav-links">
            <a href="index.html" class="nav-link active">Home</a>
            <a href="rankings.html" class="nav-link">Rankings</a>
            <a href="categories.html" class="nav-link">Categories</a>
            <a href="brands.html" class="nav-link">Brands</a>
            <a href="blog.html" class="nav-link">Blog</a>
            <a href="watchlist.html" class="nav-link">Watchlist</a>
        </div>
    </nav>
</header>

<main class="page-wrapper">
    <!-- Deals Hero -->
    <section class="deals-hero">
        <h1 class="deals-title">Today's Best Toy Deals</h1>
        <p class="deals-subtitle">Track prices across Amazon, Walmart & Target - Updated Daily</p>

        <!-- Search Bar -->
        <div class="search-container">
            <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/>
            </svg>
            <input
                type="text"
                id="heroSearch"
                class="search-input"
                placeholder="Search 14,000+ toys..."
                onkeyup="handleSearch(event)"
            />
            <div id="searchResults" class="search-dropdown"></div>
        </div>

        <!-- Stats Bar -->
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="stat-toys">--</div>
                <div class="stat-label">Toys</div>
            </div>
            <div class="stat-item">
                <div class="stat-value green" id="stat-deals">--</div>
                <div class="stat-label">On Sale</div>
            </div>
            <div class="stat-item">
                <div class="stat-value yellow" id="stat-savings">--</div>
                <div class="stat-label">Avg Savings</div>
            </div>
        </div>
    </section>

    <!-- 6-Tab Filter -->
    <div class="filter-tabs-container">
        <div class="filter-tabs-6">
            <button class="filter-tab-6 active" data-filter="hot" onclick="setFilter('hot')">
                <span class="tab-icon">&#128293;</span> Hot Now
            </button>
            <button class="filter-tab-6" data-filter="picks" onclick="setFilter('picks')">
                <span class="tab-icon">&#11088;</span> ToyTap Picks
            </button>
            <button class="filter-tab-6" data-filter="bestsellers" onclick="setFilter('bestsellers')">
                <span class="tab-icon">&#127942;</span> Best Sellers
            </button>
            <button class="filter-tab-6" data-filter="drops" onclick="setFilter('drops')">
                <span class="tab-icon">&#128200;</span> Price Drops
            </button>
            <button class="filter-tab-6" data-filter="rated" onclick="setFilter('rated')">
                <span class="tab-icon">&#11088;</span> Top Rated
            </button>
            <button class="filter-tab-6" data-filter="walmart" onclick="setFilter('walmart')">
                <span class="tab-icon">&#128154;</span> Walmart Deals
            </button>
        </div>
    </div>

    <!-- Results Header -->
    <div class="results-header">
        <div class="results-count">
            Showing <strong id="showing-count">0</strong> toys
        </div>
        <select class="sort-select" id="sort-select" onchange="handleSortChange()">
            <option value="default">Default Sort</option>
            <option value="price-low">Price: Low to High</option>
            <option value="price-high">Price: High to Low</option>
            <option value="discount">Biggest Discount</option>
            <option value="rating">Highest Rated</option>
        </select>
    </div>

    <!-- Toy Grid -->
    <section class="toy-grid-section">
        <div id="toy-grid" class="toy-grid">
            <!-- Filled by JS -->
        </div>

        <div style="text-align: center; margin-top: 40px;">
            <button id="show-more-btn" class="btn btn-primary" onclick="showMore()" style="display: none;">
                Load More Toys
            </button>
        </div>
    </section>
</main>

<!-- Footer -->
<footer class="site-footer">
    <div class="footer-container">
        <img src="https://i.imgur.com/HXSawxU.png" alt="ToyTap" class="footer-logo" />
        <div class="footer-links">
            <a href="https://gettoytap.com" class="footer-link">For Businesses</a>
            <a href="https://gettoytap.com/privacy" class="footer-link">Privacy</a>
            <a href="https://gettoytap.com/terms" class="footer-link">Terms</a>
            <a href="mailto:info@gettoytap.com" class="footer-link">Contact</a>
        </div>
        <p class="footer-copy">2025 ToyTap. All rights reserved.</p>
    </div>
</footer>

<!-- Modal -->
<div id="toy-modal" class="toy-modal-overlay" onclick="if(event.target===this)closeToyModal()">
    <div class="toy-modal">
        <button class="modal-close" onclick="closeToyModal()">&times;</button>
        <div id="modal-content-area">
            <!-- Filled by JS -->
        </div>
    </div>
</div>

<!-- Scripts -->
<script src="js/api.js"></script>
<script>
    // State
    let allToys = [];
    let filteredToys = [];
    let currentFilter = 'hot';
    let currentSort = 'default';
    let visibleCount = 24;

    // Filter configurations
    const FILTER_CONFIG = {
        hot: {
            name: 'Hot Now',
            sortFn: (toys) => {
                // Sort by recency + score combination
                return toys.sort((a, b) => {
                    const scoreA = parseFloat(a.toy_tap_score) || 0;
                    const scoreB = parseFloat(b.toy_tap_score) || 0;
                    const freshA = getFreshnessScore(a.updated_at);
                    const freshB = getFreshnessScore(b.updated_at);
                    return (scoreB + freshB * 20) - (scoreA + freshA * 20);
                });
            }
        },
        picks: {
            name: 'ToyTap Picks',
            sortFn: (toys) => {
                // Highest TT Grade Score
                return toys.sort((a, b) => {
                    const gradeA = parseFloat(a.tt_grade_score) || 0;
                    const gradeB = parseFloat(b.tt_grade_score) || 0;
                    return gradeB - gradeA;
                });
            }
        },
        bestsellers: {
            name: 'Best Sellers',
            sortFn: (toys) => {
                // Sort by reviews count (popularity)
                return toys.sort((a, b) => {
                    const revA = parseInt(a.reviews_count) || 0;
                    const revB = parseInt(b.reviews_count) || 0;
                    return revB - revA;
                });
            }
        },
        drops: {
            name: 'Price Drops',
            sortFn: (toys) => {
                // Filter to only toys with discounts, sort by discount %
                return toys
                    .filter(t => parseFloat(t.discount_percent) > 0)
                    .sort((a, b) => {
                        const discA = parseFloat(a.discount_percent) || 0;
                        const discB = parseFloat(b.discount_percent) || 0;
                        return discB - discA;
                    });
            }
        },
        rated: {
            name: 'Top Rated',
            sortFn: (toys) => {
                // Sort by rating, then reviews
                return toys.sort((a, b) => {
                    const ratingA = parseFloat(a.rating) || 0;
                    const ratingB = parseFloat(b.rating) || 0;
                    if (ratingB !== ratingA) return ratingB - ratingA;
                    return (parseInt(b.reviews_count) || 0) - (parseInt(a.reviews_count) || 0);
                });
            }
        },
        walmart: {
            name: 'Walmart Deals',
            sortFn: (toys) => {
                // Filter to Walmart toys with deals
                return toys
                    .filter(t => {
                        const retailer = (t.retailer || '').toLowerCase();
                        return retailer.includes('walmart');
                    })
                    .sort((a, b) => {
                        const discA = parseFloat(a.discount_percent) || 0;
                        const discB = parseFloat(b.discount_percent) || 0;
                        return discB - discA;
                    });
            }
        }
    };

    // Freshness score (higher = more recent)
    function getFreshnessScore(updatedAt) {
        if (!updatedAt) return 0;
        const now = new Date();
        const updated = new Date(updatedAt);
        const hoursAgo = (now - updated) / (1000 * 60 * 60);
        if (hoursAgo < 6) return 4;
        if (hoursAgo < 24) return 3;
        if (hoursAgo < 72) return 2;
        if (hoursAgo < 168) return 1;
        return 0;
    }

    // Get freshness label
    function getFreshnessLabel(updatedAt) {
        if (!updatedAt) return { class: 'old', label: 'Older' };
        const now = new Date();
        const updated = new Date(updatedAt);
        const hoursAgo = (now - updated) / (1000 * 60 * 60);

        if (hoursAgo < 6) return { class: 'fresh', label: 'Fresh' };
        if (hoursAgo < 24) return { class: 'oneday', label: '1 Day' };
        if (hoursAgo < 72) return { class: 'aging', label: '2-3 Days' };
        return { class: 'old', label: 'Older' };
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', async () => {
        showLoading(document.getElementById('toy-grid'));

        try {
            allToys = await fetchLeaderboard(200);
            updateStats();
            applyFilterAndRender();
        } catch (err) {
            console.error('Load error:', err);
            showError(document.getElementById('toy-grid'));
        }
    });

    // Update stats bar
    function updateStats() {
        const totalToys = allToys.length;
        const dealsCount = allToys.filter(t => parseFloat(t.discount_percent) > 0).length;

        // Calculate average savings
        const toysWithDeals = allToys.filter(t => parseFloat(t.discount_percent) > 0);
        let avgSavings = 0;
        if (toysWithDeals.length > 0) {
            const totalDiscount = toysWithDeals.reduce((sum, t) => sum + (parseFloat(t.discount_percent) || 0), 0);
            avgSavings = Math.round(totalDiscount / toysWithDeals.length);
        }

        document.getElementById('stat-toys').textContent = totalToys.toLocaleString();
        document.getElementById('stat-deals').textContent = dealsCount.toLocaleString();
        document.getElementById('stat-savings').textContent = avgSavings + '%';
    }

    // Set filter tab
    function setFilter(filter) {
        currentFilter = filter;
        visibleCount = 24;

        // Update tab UI
        document.querySelectorAll('.filter-tab-6').forEach(tab => {
            tab.classList.toggle('active', tab.dataset.filter === filter);
        });

        applyFilterAndRender();
    }

    // Apply filter and render
    function applyFilterAndRender() {
        const config = FILTER_CONFIG[currentFilter];
        filteredToys = config.sortFn([...allToys]);

        // Apply additional sort if selected
        if (currentSort !== 'default') {
            applySort();
        }

        renderToys();
    }

    // Apply sort
    function applySort() {
        switch (currentSort) {
            case 'price-low':
                filteredToys.sort((a, b) => (parseFloat(a.price) || 0) - (parseFloat(b.price) || 0));
                break;
            case 'price-high':
                filteredToys.sort((a, b) => (parseFloat(b.price) || 0) - (parseFloat(a.price) || 0));
                break;
            case 'discount':
                filteredToys.sort((a, b) => (parseFloat(b.discount_percent) || 0) - (parseFloat(a.discount_percent) || 0));
                break;
            case 'rating':
                filteredToys.sort((a, b) => (parseFloat(b.rating) || 0) - (parseFloat(a.rating) || 0));
                break;
        }
    }

    // Handle sort change
    function handleSortChange() {
        currentSort = document.getElementById('sort-select').value;
        applyFilterAndRender();
    }

    // Render toys
    function renderToys() {
        const toShow = filteredToys.slice(0, visibleCount);
        const grid = document.getElementById('toy-grid');

        document.getElementById('showing-count').textContent = toShow.length;

        if (toShow.length === 0) {
            grid.innerHTML = `
                <div style="grid-column: 1/-1; text-align: center; padding: 60px 20px; color: #94a3b8;">
                    <div style="font-size: 48px; margin-bottom: 16px;">&#128269;</div>
                    <p style="font-size: 18px; margin-bottom: 8px;">No toys found</p>
                    <p style="font-size: 14px;">Try a different filter</p>
                </div>
            `;
            document.getElementById('show-more-btn').style.display = 'none';
            return;
        }

        grid.innerHTML = toShow.map((toy, i) => renderDealCard(toy, i + 1)).join('');

        // Show/hide load more button
        const btn = document.getElementById('show-more-btn');
        btn.style.display = visibleCount < filteredToys.length ? 'inline-flex' : 'none';
    }

    // Render deal card with freshness and discount badges
    function renderDealCard(toy, rank) {
        const imageUrl = toy.image_url_proxied || toy.image_url || PLACEHOLDER_IMG;
        const hasDiscount = parseFloat(toy.discount_percent) > 0;
        const discountPct = hasDiscount ? parseFloat(toy.discount_percent).toFixed(0) : 0;
        const freshness = getFreshnessLabel(toy.updated_at);
        const isWalmart = (toy.retailer || '').toLowerCase().includes('walmart');

        // Cache for modal
        window.toyCache[toy.asin] = toy;

        // Rank display for top 3
        let rankBadge = '';
        if (rank <= 3) {
            const medals = { 1: '&#129351;', 2: '&#129352;', 3: '&#129353;' };
            rankBadge = `<div class="toy-card-rank top-3">${medals[rank]}</div>`;
        }

        return `
            <div class="toy-card ${rank <= 3 ? 'rank-' + rank : ''}" onclick="openToyModal('${toy.asin}')">
                ${rankBadge}

                ${hasDiscount ? `<div class="toy-card-deal-badge">-${discountPct}%</div>` : ''}

                <div class="toy-card-freshness">
                    <span class="freshness-pill ${freshness.class}">${freshness.label}</span>
                </div>

                <div class="toy-card-image-wrap">
                    <img src="${imageUrl}" alt="${toy.toy_name}" class="toy-card-image" onerror="this.src='${PLACEHOLDER_IMG}';">
                    <div class="toy-card-metric">${renderGradeBadge(toy.tt_grade, 'lg')}</div>
                </div>

                <div class="toy-card-content">
                    <div class="toy-card-brand">${toy.brand || 'Brand'}</div>
                    <div class="toy-card-name">${toy.toy_name}</div>
                    <div class="toy-card-info">
                        <span>&#11088; ${toy.rating || 'N/A'}</span>
                        <span>&#128172; ${(toy.reviews_count || 0).toLocaleString()}</span>
                    </div>
                    <div class="toy-card-price">
                        $${formatPrice(toy.price)}
                        ${hasDiscount ? `<span class="toy-card-original-price">$${formatPrice(toy.compare_price)}</span>` : ''}
                    </div>
                    ${isWalmart ? '<div class="walmart-badge">&#128154; Walmart</div>' : ''}
                </div>
            </div>
        `;
    }

    function showMore() {
        visibleCount += 24;
        renderToys();
    }

    // Search functionality
    let searchTimeout;

    function handleSearch(e) {
        clearTimeout(searchTimeout);
        const query = e.target.value.trim();
        const results = document.getElementById('searchResults');

        if (query.length < 2) {
            results.innerHTML = '';
            results.style.display = 'none';
            return;
        }

        searchTimeout = setTimeout(async () => {
            try {
                const res = await fetch(`${API_BASE}/toys/search?q=${encodeURIComponent(query)}&limit=8`);
                const data = await res.json();
                const toys = data.toys || data || [];

                if (toys.length === 0) {
                    results.innerHTML = '<div style="padding: 20px; text-align: center; color: #94a3b8;">No toys found</div>';
                } else {
                    results.innerHTML = toys.map(toy => {
                        window.toyCache[toy.asin] = toy;
                        return `
                            <div class="search-result" onclick="openToyModal('${toy.asin}'); document.getElementById('searchResults').style.display='none';">
                                <img src="${toy.image_url_proxied || toy.image_url || PLACEHOLDER_IMG}" alt="" />
                                <div class="search-result-info">
                                    <div class="search-result-name">${toy.toy_name}</div>
                                    <div class="search-result-brand">${toy.brand || ''}</div>
                                </div>
                                <div class="search-result-price">$${formatPrice(toy.price)}</div>
                            </div>
                        `;
                    }).join('');
                }
                results.style.display = 'block';
            } catch (err) {
                console.error('Search error:', err);
            }
        }, 300);
    }

    // Close search on click outside
    document.addEventListener('click', (e) => {
        if (!e.target.closest('#heroSearch') && !e.target.closest('#searchResults')) {
            document.getElementById('searchResults').style.display = 'none';
        }
    });
</script>

</body>
</html>
