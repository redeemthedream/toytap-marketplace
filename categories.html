<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Categories - Toy Tap</title>
    <meta name="description" content="Browse toys by category and age group. Building toys, vehicles, outdoor, dolls, educational, and more." />
    <link rel="icon" type="image/png" href="https://i.imgur.com/HXSawxU.png" />
    <link rel="stylesheet" href="css/styles.css" />
    <style>
        /* Categories Page Styles */
        .categories-hero {
            background: linear-gradient(135deg, #0a0e27 0%, var(--navy-dark) 50%, #1a1a2e 100%);
            padding: 50px 20px;
            text-align: center;
        }

        .categories-title {
            font-size: clamp(28px, 6vw, 48px);
            font-weight: 900;
            color: #fff;
            margin-bottom: 12px;
        }

        .categories-subtitle {
            font-size: 16px;
            color: rgba(255,255,255,0.7);
        }

        /* Age Group Selector */
        .age-selector {
            padding: 24px 20px;
            text-align: center;
            background: var(--bg-dark);
            border-bottom: 1px solid rgba(109,195,213,0.1);
            position: sticky;
            top: 70px;
            z-index: 100;
        }

        .age-label {
            font-size: 14px;
            color: #94a3b8;
            margin-bottom: 12px;
        }

        .age-pills {
            display: inline-flex;
            gap: 8px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .age-pill {
            padding: 10px 20px;
            background: var(--bg-card);
            border: 1px solid rgba(109,195,213,0.2);
            border-radius: 50px;
            font-size: 13px;
            font-weight: 600;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.2s;
        }

        .age-pill:hover {
            background: rgba(109,195,213,0.1);
            color: #fff;
        }

        .age-pill.active {
            background: var(--cyan);
            color: var(--navy);
            border-color: var(--cyan);
        }

        /* Category Grid */
        .category-section {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .section-title {
            font-size: 24px;
            font-weight: 800;
            color: #fff;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 16px;
        }

        .category-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 28px 16px;
            text-align: center;
            border: 1px solid rgba(109,195,213,0.15);
            cursor: pointer;
            transition: all 0.3s;
        }

        .category-card:hover {
            background: rgba(109,195,213,0.1);
            border-color: var(--cyan);
            transform: translateY(-4px);
        }

        .category-card.active {
            border-color: var(--cyan);
            background: rgba(109,195,213,0.15);
        }

        .category-icon {
            font-size: 44px;
            margin-bottom: 12px;
        }

        .category-name {
            font-size: 15px;
            font-weight: 700;
            color: #fff;
            margin-bottom: 4px;
        }

        .category-count {
            font-size: 12px;
            color: var(--cyan);
        }

        /* Subcategory Pills */
        .subcategory-section {
            padding: 20px;
            background: rgba(0,0,0,0.2);
            border-radius: 16px;
            margin-bottom: 24px;
        }

        .subcategory-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
        }

        .subcategory-pill {
            background: rgba(109,195,213,0.15);
            color: var(--cyan);
            padding: 12px 24px;
            border-radius: 50px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border: 1px solid transparent;
            transition: all 0.2s;
        }

        .subcategory-pill:hover {
            background: rgba(109,195,213,0.3);
        }

        .subcategory-pill.active {
            background: var(--cyan);
            color: var(--navy);
        }

        /* Back Button */
        .back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            color: var(--cyan);
            font-weight: 600;
            cursor: pointer;
            margin-bottom: 20px;
            padding: 10px 0;
            transition: opacity 0.2s;
        }

        .back-btn:hover {
            opacity: 0.8;
        }

        /* Toys View Header */
        .toys-header {
            max-width: 1200px;
            margin: 0 auto;
            padding: 24px 20px;
        }

        .toys-title {
            font-size: 28px;
            font-weight: 800;
            color: #fff;
            margin-bottom: 8px;
        }

        .toys-count {
            font-size: 14px;
            color: #94a3b8;
        }

        .toys-count strong {
            color: var(--cyan);
        }

        /* Sort Controls */
        .sort-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto 20px;
            padding: 0 20px;
        }

        .sort-select {
            background: var(--bg-card);
            border: 1px solid rgba(109,195,213,0.2);
            border-radius: 8px;
            padding: 10px 16px;
            color: #fff;
            font-size: 14px;
            cursor: pointer;
        }

        /* Mobile */
        @media (max-width: 640px) {
            .category-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 12px;
            }

            .category-card {
                padding: 20px 12px;
            }

            .category-icon {
                font-size: 36px;
            }

            .category-name {
                font-size: 13px;
            }
        }
    </style>
</head>
<body>

<header class="site-header">
    <nav class="nav-container">
        <a href="index.html"><img src="https://i.imgur.com/HXSawxU.png" alt="Toy Tap" class="nav-logo" /></a>
        <button class="nav-toggle" onclick="document.querySelector('.nav-links').classList.toggle('open')">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 12h18M3 6h18M3 18h18"/></svg>
        </button>
        <div class="nav-links">
            <a href="index.html" class="nav-link">Home</a>
            <a href="rankings.html" class="nav-link">Rankings</a>
            <a href="categories.html" class="nav-link active">Categories</a>
            <a href="brands.html" class="nav-link">Brands</a>
            <a href="blog.html" class="nav-link">Blog</a>
            <a href="watchlist.html" class="nav-link">Watchlist</a>
        </div>
    </nav>
</header>

<main class="page-wrapper">
    <!-- Categories View -->
    <div id="categories-view">
        <section class="categories-hero">
            <h1 class="categories-title">Browse by Category</h1>
            <p class="categories-subtitle">Find the perfect toy in any category</p>
        </section>

        <!-- Age Group Selector -->
        <div class="age-selector">
            <div class="age-label">Filter by Age Group</div>
            <div class="age-pills">
                <div class="age-pill" data-age="Baby" onclick="selectAge('Baby')">&#128118; Baby (0-12m)</div>
                <div class="age-pill" data-age="Toddler" onclick="selectAge('Toddler')">&#128103; Toddler (1-3y)</div>
                <div class="age-pill" data-age="Preschool" onclick="selectAge('Preschool')">&#128102; Preschool (3-5y)</div>
                <div class="age-pill" data-age="Kids" onclick="selectAge('Kids')">&#129490; Kids (5-7y)</div>
                <div class="age-pill" data-age="Tweens" onclick="selectAge('Tweens')">&#128526; Tweens (8-12y)</div>
            </div>
        </div>

        <!-- All Categories -->
        <section class="category-section">
            <h2 class="section-title">&#128193; All Categories</h2>
            <div class="category-grid" id="category-grid"></div>
        </section>
    </div>

    <!-- Toys View (shown when category selected) -->
    <div id="toys-view" style="display: none;">
        <section class="categories-hero">
            <h1 class="categories-title" id="toys-title">Category</h1>
            <p class="categories-subtitle" id="toys-subtitle">Browse toys</p>
        </section>

        <div class="toys-header">
            <div class="back-btn" onclick="showCategories()">&#8592; Back to Categories</div>

            <div class="subcategory-section">
                <div id="subcategory-pills" class="subcategory-pills"></div>
            </div>
        </div>

        <div class="sort-bar">
            <div class="toys-count">
                Showing <strong id="showing-count">0</strong> toys
            </div>
            <select class="sort-select" id="sort-select" onchange="handleSortChange()">
                <option value="score">Best Match</option>
                <option value="price-low">Price: Low to High</option>
                <option value="price-high">Price: High to Low</option>
                <option value="rating">Highest Rated</option>
                <option value="popular">Most Popular</option>
            </select>
        </div>

        <section class="toy-grid-section">
            <div id="toy-grid" class="toy-grid"></div>
            <div style="text-align: center; margin-top: 40px;">
                <button id="show-more-btn" class="btn btn-primary" onclick="showMore()" style="display: none;">
                    Load More Toys
                </button>
            </div>
        </section>
    </div>

    <!-- Age View (shown when age selected) -->
    <div id="age-view" style="display: none;">
        <section class="categories-hero">
            <h1 class="categories-title" id="age-title">Age Group</h1>
            <p class="categories-subtitle" id="age-subtitle">Toys for this age</p>
        </section>

        <div class="toys-header">
            <div class="back-btn" onclick="showCategories()">&#8592; Back to Categories</div>
        </div>

        <div class="sort-bar">
            <div class="toys-count">
                Showing <strong id="age-showing-count">0</strong> toys
            </div>
            <select class="sort-select" id="age-sort-select" onchange="handleAgeSortChange()">
                <option value="score">Best Match</option>
                <option value="price-low">Price: Low to High</option>
                <option value="price-high">Price: High to Low</option>
                <option value="rating">Highest Rated</option>
            </select>
        </div>

        <section class="toy-grid-section">
            <div id="age-toy-grid" class="toy-grid"></div>
            <div style="text-align: center; margin-top: 40px;">
                <button id="age-show-more-btn" class="btn btn-primary" onclick="showMoreAge()" style="display: none;">
                    Load More Toys
                </button>
            </div>
        </section>
    </div>
</main>

<footer class="site-footer">
    <div class="footer-container">
        <img src="https://i.imgur.com/HXSawxU.png" alt="Toy Tap" class="footer-logo" />
        <div class="footer-links">
            <a href="https://gettoytap.com" class="footer-link">For Businesses</a>
            <a href="https://gettoytap.com/privacy" class="footer-link">Privacy</a>
        </div>
        <p class="footer-copy">2025 Toy Tap. All rights reserved.</p>
    </div>
</footer>

<div id="toy-modal" class="toy-modal-overlay" onclick="if(event.target===this)closeToyModal()">
    <div class="toy-modal">
        <button class="modal-close" onclick="closeToyModal()">&times;</button>
        <div id="modal-content-area"></div>
    </div>
</div>

<script src="js/api.js"></script>
<script>
// Full category data with icons, API names, and subcategories
const CATEGORIES = {
    'Building & Construction': {
        icon: '&#129521;',
        subcategories: ['Building Blocks', 'Magnetic Tiles', 'LEGO', 'Marble Runs', 'Construction Sets']
    },
    'Vehicles': {
        icon: '&#128663;',
        subcategories: ['Cars & Trucks', 'Trains & Railways', 'Ride On Cars', 'Remote Control', 'Airplanes & Helicopters']
    },
    'Outdoor & Sports': {
        icon: '&#127966;',
        subcategories: ['Swing Sets', 'Playsets', 'Sand & Water', 'Sports', 'Bikes & Scooters', 'Trampolines']
    },
    'Baby & Toddler': {
        icon: '&#128118;',
        subcategories: ['Baby Toys', 'Toddler Toys', 'Bath Toys', 'Sensory Toys', 'Teethers & Rattles']
    },
    'Educational': {
        icon: '&#127891;',
        subcategories: ['STEM Toys', 'Montessori', 'Learning Games', 'Science Kits', 'Coding Toys']
    },
    'Pretend Play': {
        icon: '&#127917;',
        subcategories: ['Playsets', 'Kitchen & Food', 'Dress Up', 'Dolls House', 'Tool Sets']
    },
    'Arts & Crafts': {
        icon: '&#127912;',
        subcategories: ['Drawing & Coloring', 'Craft Kits', 'Play-Doh & Clay', 'Jewelry Making', 'Painting']
    },
    'Games & Puzzles': {
        icon: '&#129513;',
        subcategories: ['Puzzles', 'Board Games', 'Card Games', 'Strategy Games', 'Family Games']
    },
    'Dolls & Accessories': {
        icon: '&#129528;',
        subcategories: ['Dolls', 'Stuffed Animals', 'Doll Accessories', 'Barbie', 'Baby Dolls']
    },
    'Electronics': {
        icon: '&#129302;',
        subcategories: ['Interactive Toys', 'Musical Toys', 'Tablets & Computers', 'Robots', 'Drones']
    },
    'Action Figures': {
        icon: '&#129464;',
        subcategories: ['Action Figures', 'Playsets', 'Collectibles', 'Superheroes', 'Dinosaurs']
    }
};

// Age group mappings
const AGE_GROUPS = {
    'Baby': { label: 'Baby (0-12 months)', icon: '&#128118;', apiValue: '0-12 months' },
    'Toddler': { label: 'Toddler (1-3 years)', icon: '&#128103;', apiValue: '1-3 years' },
    'Preschool': { label: 'Preschool (3-5 years)', icon: '&#128102;', apiValue: '3-5 years' },
    'Kids': { label: 'Kids (5-7 years)', icon: '&#129490;', apiValue: '5-7 years' },
    'Tweens': { label: 'Tweens (8-12 years)', icon: '&#128526;', apiValue: '8-12 years' }
};

// State
let currentCategory = null;
let currentSubcategory = null;
let currentAge = null;
let toys = [];
let ageToys = [];
let visibleCount = 24;
let ageVisibleCount = 24;
let currentSort = 'score';
let currentAgeSort = 'score';

// Initialize
document.addEventListener('DOMContentLoaded', () => {
    const urlCat = getUrlParam('cat');
    const urlAge = getUrlParam('age');

    if (urlCat && CATEGORIES[urlCat]) {
        selectCategory(urlCat);
    } else if (urlAge && AGE_GROUPS[urlAge]) {
        selectAge(urlAge);
    } else {
        renderCategories();
    }
});

// Render all categories
function renderCategories() {
    const grid = document.getElementById('category-grid');
    grid.innerHTML = Object.entries(CATEGORIES).map(([name, data]) => `
        <div class="category-card" onclick="selectCategory('${name}')">
            <div class="category-icon">${data.icon}</div>
            <div class="category-name">${name}</div>
            <div class="category-count">${data.subcategories.length} subcategories</div>
        </div>
    `).join('');
}

// Select a category
async function selectCategory(name) {
    currentCategory = name;
    currentSubcategory = null;
    currentAge = null;
    visibleCount = 24;
    currentSort = 'score';

    const cat = CATEGORIES[name];

    document.getElementById('toys-title').textContent = name;
    document.getElementById('toys-subtitle').textContent = `Explore ${name.toLowerCase()} toys`;

    // Build subcategory pills
    document.getElementById('subcategory-pills').innerHTML = `
        <div class="subcategory-pill active" onclick="selectSubcategory(null)">All ${name}</div>
        ${cat.subcategories.map(sub => `
            <div class="subcategory-pill" onclick="selectSubcategory('${sub}')">${sub}</div>
        `).join('')}
    `;

    document.getElementById('categories-view').style.display = 'none';
    document.getElementById('age-view').style.display = 'none';
    document.getElementById('toys-view').style.display = 'block';

    // Reset age pills
    document.querySelectorAll('.age-pill').forEach(p => p.classList.remove('active'));

    await loadCategoryToys();
}

// Select a subcategory
async function selectSubcategory(sub) {
    currentSubcategory = sub;
    visibleCount = 24;

    document.querySelectorAll('.subcategory-pill').forEach((p, i) => {
        const isAll = p.textContent.startsWith('All ');
        p.classList.toggle('active', sub ? p.textContent === sub : isAll);
    });

    await loadCategoryToys();
}

// Load toys for category
async function loadCategoryToys() {
    const grid = document.getElementById('toy-grid');
    showLoading(grid);

    try {
        toys = await fetchByCategory(currentCategory, currentSubcategory, currentSort);
        sortToys();
        renderCategoryToys();
    } catch (err) {
        console.error('Load error:', err);
        showError(grid);
    }
}

// Sort toys
function sortToys() {
    switch (currentSort) {
        case 'price-low':
            toys.sort((a, b) => (parseFloat(a.price) || 0) - (parseFloat(b.price) || 0));
            break;
        case 'price-high':
            toys.sort((a, b) => (parseFloat(b.price) || 0) - (parseFloat(a.price) || 0));
            break;
        case 'rating':
            toys.sort((a, b) => (parseFloat(b.rating) || 0) - (parseFloat(a.rating) || 0));
            break;
        case 'popular':
            toys.sort((a, b) => (parseInt(b.reviews_count) || 0) - (parseInt(a.reviews_count) || 0));
            break;
        default: // score
            toys.sort((a, b) => (parseFloat(b.toy_tap_score) || 0) - (parseFloat(a.toy_tap_score) || 0));
    }
}

// Render category toys
function renderCategoryToys() {
    const toShow = toys.slice(0, visibleCount);
    document.getElementById('showing-count').textContent = toShow.length;
    document.getElementById('toy-grid').innerHTML = toShow.map(toy => renderToyCard(toy, { showGrade: true, linkToDetail: true })).join('');
    document.getElementById('show-more-btn').style.display = visibleCount < toys.length ? 'inline-flex' : 'none';
}

// Handle sort change
function handleSortChange() {
    currentSort = document.getElementById('sort-select').value;
    sortToys();
    renderCategoryToys();
}

// Show more toys
function showMore() {
    visibleCount += 24;
    renderCategoryToys();
}

// Select age group
async function selectAge(age) {
    currentAge = age;
    currentCategory = null;
    currentSubcategory = null;
    ageVisibleCount = 24;
    currentAgeSort = 'score';

    const ageData = AGE_GROUPS[age];

    document.getElementById('age-title').innerHTML = `${ageData.icon} ${ageData.label}`;
    document.getElementById('age-subtitle').textContent = `Perfect toys for ${age.toLowerCase()} aged children`;

    document.getElementById('categories-view').style.display = 'none';
    document.getElementById('toys-view').style.display = 'none';
    document.getElementById('age-view').style.display = 'block';

    // Update age pills
    document.querySelectorAll('.age-pill').forEach(p => {
        p.classList.toggle('active', p.dataset.age === age);
    });

    await loadAgeToys();
}

// Load toys by age
async function loadAgeToys() {
    const grid = document.getElementById('age-toy-grid');
    showLoading(grid);

    try {
        const ageValue = AGE_GROUPS[currentAge].apiValue;
        ageToys = await fetchByAge(ageValue, currentAgeSort);
        sortAgeToys();
        renderAgeToys();
    } catch (err) {
        console.error('Load error:', err);
        showError(grid);
    }
}

// Sort age toys
function sortAgeToys() {
    switch (currentAgeSort) {
        case 'price-low':
            ageToys.sort((a, b) => (parseFloat(a.price) || 0) - (parseFloat(b.price) || 0));
            break;
        case 'price-high':
            ageToys.sort((a, b) => (parseFloat(b.price) || 0) - (parseFloat(a.price) || 0));
            break;
        case 'rating':
            ageToys.sort((a, b) => (parseFloat(b.rating) || 0) - (parseFloat(a.rating) || 0));
            break;
        default:
            ageToys.sort((a, b) => (parseFloat(b.toy_tap_score) || 0) - (parseFloat(a.toy_tap_score) || 0));
    }
}

// Render age toys
function renderAgeToys() {
    const toShow = ageToys.slice(0, ageVisibleCount);
    document.getElementById('age-showing-count').textContent = toShow.length;
    document.getElementById('age-toy-grid').innerHTML = toShow.map(toy => renderToyCard(toy, { showGrade: true, linkToDetail: true })).join('');
    document.getElementById('age-show-more-btn').style.display = ageVisibleCount < ageToys.length ? 'inline-flex' : 'none';
}

// Handle age sort change
function handleAgeSortChange() {
    currentAgeSort = document.getElementById('age-sort-select').value;
    sortAgeToys();
    renderAgeToys();
}

// Show more age toys
function showMoreAge() {
    ageVisibleCount += 24;
    renderAgeToys();
}

// Back to categories
function showCategories() {
    document.getElementById('categories-view').style.display = 'block';
    document.getElementById('toys-view').style.display = 'none';
    document.getElementById('age-view').style.display = 'none';
    currentCategory = null;
    currentAge = null;

    // Reset age pills
    document.querySelectorAll('.age-pill').forEach(p => p.classList.remove('active'));
}
</script>
</body>
</html>
